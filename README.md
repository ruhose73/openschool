ВНИМАНИЕ!!! Проект временно сломан в связи с глобальным изменением его структуры. Скоро всё поправим.

# OpenSchool

**OpenSchool - бесплатная и открытая образовательная платформа, которая ставит своей целью быть центральным инструментом в процессе обучения на любые темы.**
[Читать подробнее>>](https://grandcore.org/#/ru/openschool)

- [Основной чат проекта](https://t.me/openschool_chat)
- [Чат программистов](https://t.me/joinchat/CdXoy9PeAjI2NTJh)
- [Чат дизайнеров](https://t.me/joinchat/2JC3zklOvggxN2Jh)

## Запуск на локальной машине

Для сборки и запуска проекта необходимо установить [docker](https://www.docker.com/https://www.docker.com/get-started) и [docker-compose](https://docs.docker.com/compose/install/). Также необходимо запустить [docker daemon](https://docs.docker.com/config/daemon/), если он не запущен.

Для построения и запуска проекта создан _Makefile_. Для пользователей Windows необходимо произвести [дополнительную настройку](https://stackoverflow.com/questions/2532234/how-to-run-a-makefile-in-windows)

**Примечания**

- Архитектура проекта описывается и обсуждается в [Trello](https://trello.com/b/POeLUekC)
- Все контейнеры находятся в одной сети network

### Список приложений

_Если сборка прошла успешно и все контейнеры запущены, то по следующим адресам доступны приложения:_

- default ([localhost:3000](http://localhost:3000)) - точка входа. Роутер Nginx;
- other ([localhost:3100](http://localhost:3100)) - разделы с контентом для совместного редактирования сообществом;
- study ([localhost:3200](http://localhost:3200)) - всё связанное с курсами и процессом обучения пользователей. Прогрессом пользователя занимается приложение users;
- extra ([localhost:3300](http://localhost:3300)) - Агрегация и управление логами со всех приложений и другими мета-данными.
- auth ([localhost:4000](http://localhost:4000)) - Авторизация, которая может работать в том числе в других проектах.
- users ([localhost:4100](http://localhost:4100)) - Управление пользователями и группами, в том числе управление прогрессом пользователя в обучении;
- frontend ([localhost:5000](http://localhost:5000)) - Отрисовка всего фронта, кроме админки и процессов;
- processes ([localhost:6000](http://localhost:6000)) - Процессы EDem. Приложение для коллективного управления платформой. И фронт и бек;
- admin ([localhost:7000](http://localhost:7000)) - административная панель. И фронт и бек;

Все приложения также доступны через `localhost:3000/api/app_name`, кроме admin, которое доступно по `localhost:3000/admin` и frontend, которое доступно по `localhost:3000/`

Приложения находятся в одной сети. Изнутри любого контейнера их можно перекрёстно пропинговать по названию приложения. Например: `ping admin`.

### Команды запуска

- `make build` - сборка всей сети контейнеров без последующего поднятия;
- `make up` - поднять сеть и все контейнеры;
- `make logs` - подключиться к выводу логов с каждого контейнера.

### Команды управления состоянием

- `make pause` - приостановить выполнение всех контейнеров с сохранением их состояния;
- `make unpase` - возобновить выполнение всех контейнеров, если они были приостановлены;
- `make stop` - остановка всех контейнеров;
- `make down` - остановка всех контейнеров с последующим удалением;
- `make restart` - перезапуск всех контейнеров;
- `make destroy` - остановка всех контейнеров с удалением контейнеров, volumes и сети;

### Команды контроля и обслуживания

- `make logs-[name_app]` - подключиться к выводу логов с контейнера конкретного приложения (см. список выше);
- `make ps` - вывести список и статус работающих контейнеров только из тех, которые определены в _docker-compose.yml_;
- `make login-[name_app]` - подключиться к терминалу контейнера конкретного приложения (см. список выше).

### Запуск без Makefile

- docker-compose up --build - Собрать и запустить

### Переменные среды

Переменные среды каждого контейнера находятся в папке _`envs`_. Название каждого файла соответствует названию контейнера: _container_name-variables.env_.
В каждой папке сервиса находится `Dockerfile` в котором определены основные настройки каждого контейнера.

localhost:3000/api/server-name (api-name)
localhost:3000
localhost:3000/admin
localhost:3000/processes

## Новые порты

### server

- nginx - 3000
- api-auth - 3100
- api-content - 3200
- api-users - 3300
- api-extra - 3400
- api-stuff - 3500

### data

- storage - 4000
- db-auth - 4100
- db-content - 4200
- db-users - 4300
- db-extra - 4400
- db-stuff - 4500

### web

- front-public - 5000
- front processes - 5100
- front-admin - 5200

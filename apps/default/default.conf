upstream frontend{
	server frontend:5000;
}

upstream admin{
	server admin:7000;
}

upstream other{
	server other:3100;
}

upstream auth{
	server auth:4000;
}

upstream study{
	server study:3200;
}

upstream users{
	server users:4100;
}

upstream extra{
	server extra:3300;
}

upstream processes{
	server processes:9000;
}

server { 
	listen 80; 
	server_name openschool.org; 

	location = / { 
		proxy_pass http://frontend; 
		proxy_http_version 1.1; 
		proxy_set_header Upgrade $http_upgrade; 
		proxy_set_header Connection 'upgrade'; 
		proxy_set_header Host $host; 
		proxy_cache_bypass $http_upgrade; 
	}


	location ^~ /admin { 
        rewrite /admin/(.*) /$1 break;
		rewrite /admin(.*) /$1 break;
        proxy_pass  http://admin;
	}

	location ^~ /api/auth { 
        rewrite /api/auth/(.*) /$1 break;
		rewrite /api/auth(.*) /$1 break;
        proxy_pass  http://auth;
	} 

	location ^~ /api/study { 
        rewrite /api/study/(.*) /$1 break;
		rewrite /api/study(.*) /$1 break;
        proxy_pass  http://study;
	}

	location ^~ /api/users { 
        rewrite /api/users/(.*) /$1 break;
		rewrite /api/users(.*) /$1 break;
        proxy_pass  http://users;
	} 

	location ^~ /api/extra { 
        rewrite /api/extra/(.*) /$1 break;
		rewrite /api/extra(.*) /$1 break;
        proxy_pass  http://extra;
	} 

	location ^~ /api/other { 
        rewrite /api/other/(.*) /$1 break;
		rewrite /api/other(.*) /$1 break;
        proxy_pass  http://other;
	} 

	location ^~ /api/processes { 
        rewrite /api/processes/(.*) /$1 break;
		rewrite /api/processes(.*) /$1 break;
        proxy_pass  http://processes;
	} 

	
} 
